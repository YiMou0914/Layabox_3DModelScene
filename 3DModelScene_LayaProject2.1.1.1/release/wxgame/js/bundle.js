var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])};return function(t,a){function o(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(o.prototype=a.prototype,new o)}}();!function(){function e(t,a,o){function n(r,s){if(!a[r]){if(!t[r]){var c="function"==typeof require&&require;if(!s&&c)return c(r,!0);if(i)return i(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var h=a[r]={exports:{}};t[r][0].call(h.exports,function(e){var a=t[r][1][e];return n(a||e)},h,h.exports,e,t,a,o)}return a[r].exports}for(var i="function"==typeof require&&require,r=0;r<o.length;r++)n(o[r]);return n}return e}()({1:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("./scripts/GameMgr"),n=function(){function e(){}return e.init=function(){var e=Laya.ClassUtils.regClass;e("scripts/GameMgr.ts",o["default"])},e.width=640,e.height=1136,e.scaleMode="fixedwidth",e.screenMode="none",e.alignV="top",e.alignH="left",e.startScene="Main.scene",e.sceneRoot="",e.debug=!0,e.stat=!1,e.physicsDebug=!1,e.exportSceneToJson=!0,e}();a["default"]=n,n.init()},{"./scripts/GameMgr":4}],2:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("./GameConfig"),n=function(){function e(){window.Laya3D?Laya3D.init(o["default"].width,o["default"].height):Laya.init(o["default"].width,o["default"].height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=o["default"].scaleMode,Laya.stage.screenMode=o["default"].screenMode,Laya.stage.alignV=o["default"].alignV,Laya.stage.alignH=o["default"].alignH,Laya.URL.exportSceneToJson=o["default"].exportSceneToJson,(o["default"].debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),o["default"].physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),o["default"].stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}return e.prototype.onVersionLoaded=function(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))},e.prototype.onConfigLoaded=function(){o["default"].startScene&&Laya.Scene.open(o["default"].startScene)},e}();new n},{"./GameConfig":1}],3:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("./GameMgr"),n=e("./utils/Mathf"),i=function(e){function t(){var t=e.call(this)||this;return t.G_fZoomSpeed=-16,t.distance=5,t.minDistance=.6,t.maxDistance=20,t.x=0,t.y=0,t.z=0,t.yMinLimit=-90,t.yMaxLimit=90,t.leftMax=-365,t.rightMax=365,t.xSpeed=5,t.ySpeed=5,t.rotation=new Laya.Quaternion,t.position=new Laya.Vector3,t.curTouchCount=0,t}return __extends(t,e),Object.defineProperty(t.prototype,"targetPos",{get:function(){return this.target.transform.position},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraPos",{get:function(){return null==this._cameraPos&&(this._cameraPos=this.cameraNode.transform.position),this._cameraPos},set:function(e){this.cameraNode.transform.position=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cameraRot",{get:function(){return null==this._cameraRot&&(this._cameraRot=this.cameraNode.transform.rotation),this._cameraRot},set:function(e){this.cameraNode.transform.rotation=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"camViewTargetPos",{get:function(){return null==this._camViewTargetPos&&(this._camViewTargetPos=this.targetPos),this._camViewTargetPos},set:function(e){this._camViewTargetPos=e},enumerable:!0,configurable:!0}),t.prototype.onStart=function(){console.log(o["default"].instance.scene3D),this.cameraNode=o["default"].instance.scene3D.getChildByName("Main Camera"),this.target=o["default"].instance.scene3D.getChildByName("00anganzhafa"),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,this.handleMouseDown),Laya.stage.on(Laya.Event.MOUSE_UP,this,this.handleMouseUp),Laya.stage.on(Laya.Event.MOUSE_WHEEL,this,this.handleMouseWheel),this.SetCamPoint(this.cameraPos)},t.prototype.SetCamPoint=function(e){this.cameraPos=e;var t=n["default"].GetToTargetRotation(n["default"].Vec_Sub(this.camViewTargetPos,this.cameraPos));this.cameraRot=t,this.AdjustValue()},t.prototype.AdjustValue=function(){this.distance=Laya.Vector3.distance(this.camViewTargetPos,this.cameraPos),console.log("重置distance:"+this.distance),this.position=this.cameraPos,this.rotation=this.cameraRot,this.x=n["default"].QuaToVec(this.cameraRot).x,this.y=n["default"].QuaToVec(this.cameraRot).y,this.z=n["default"].QuaToVec(this.cameraRot).z,console.log("调整后Camera的rotation:"+this.cameraNode.transform.rotationEuler.x+" "+this.cameraNode.transform.rotationEuler.y+" "+this.cameraNode.transform.rotationEuler.z)},t.prototype.handleMouseDown=function(e){var t=e.touches;void 0==t&&(t=new Array,t[0]=e),this.curTouchCount=t.length,this.oldTouch0=new Laya.Vector3(t[0].stageX,t[0].stageY,0),2==this.curTouchCount&&(this.oldTouch1=new Laya.Vector3(t[1].stageX,t[1].stageY,0)),Laya.stage.on(Laya.Event.MOUSE_MOVE,this,this.handleMouseMove),Laya.stage.on(Laya.Event.MOUSE_OUT,this,this.handleMouseUp)},t.prototype.handleMouseMove=function(e){var t=e.touches;void 0==t&&(t=new Array,t[0]=e),2==t.length&&(this.curTouchCount=2),1==this.curTouchCount?this.onTouchOne(t[0]):2==this.curTouchCount&&this.onTouchTwo(e)},t.prototype.onTouchOne=function(e){1==this.isNeedAdjust&&(this.AdjustValue(),this.isNeedAdjust=!1),this.newTouch0=new Laya.Vector3(e.stageX,e.stageY,0);var t=n["default"].Vec_Sub(this.newTouch0,this.oldTouch0);this.x+=t.y*this.xSpeed*-.05,this.y+=t.x*this.ySpeed*-.05,this.distance=n["default"].Clamp(this.distance,this.minDistance,this.maxDistance),this.x=n["default"].Clamp(this.x,-90,90),this.rotation=n["default"].VecToQua(new Laya.Vector3(this.x,this.y,this.z)),this.position=n["default"].Vec_Add(n["default"].VecDotQua(new Laya.Vector3(0,0,this.distance),this.rotation),this.camViewTargetPos),this.cameraPos=this.position,this.cameraRot=this.rotation,this.oldTouch0=this.newTouch0},t.prototype.onTouchTwo=function(e){var t=e.touches;if(void 0!=t||2==t.length){this.newTouch0=new Laya.Vector3(t[0].stageX,t[0].stageY,0),this.newTouch1=new Laya.Vector3(t[1].stageX,t[1].stageY,0);var a=Laya.Vector3.distance(this.oldTouch0,this.oldTouch1),o=Laya.Vector3.distance(this.newTouch0,this.newTouch1),n=o-a;this.HorVerMoveByTouch(t),this.processToFarAndNear(n/30),this.oldTouch0=this.newTouch0,this.oldTouch1=this.newTouch1}},t.prototype.HorVerMoveByTouch=function(e){var t=n["default"].Vec_Mul(n["default"].Vec_Add(this.newTouch0,this.newTouch1),.5),a=n["default"].Vec_Mul(n["default"].Vec_Add(this.oldTouch0,this.oldTouch1),.5),o=n["default"].Vec_Mul(n["default"].Vec_Sub(t,a),.0025);if(Laya.Vector3.scalarLength(o)>.005){var i=n["default"].VecDotQua(new Laya.Vector3(-o.x,o.y,0),this.cameraRot);this.cameraPos=n["default"].Vec_Add(this.cameraPos,i),this.camViewTargetPos=n["default"].Vec_Add(this.camViewTargetPos,i),this.isNeedAdjust=!0}},t.prototype.handleMouseUp=function(e){console.log(e.type),Laya.stage.off(Laya.Event.MOUSE_MOVE,this,this.handleMouseMove),Laya.stage.off(Laya.Event.MOUSE_OUT,this,this.handleMouseUp),this.AdjustValue()},t.prototype.handleMouseWheel=function(e){var t=e.delta;this.processToFarAndNear(t)},t.prototype.processToFarAndNear=function(e){if(console.log("scaleFactor:"+e),Math.abs(e)>.02){var t=n["default"].Vec_Add(this.cameraPos,n["default"].Vec_Mul(n["default"].Vec_Normalize(n["default"].Vec_Sub(this.cameraPos,this.camViewTargetPos)),e*this.G_fZoomSpeed*.01)),a=n["default"].Vec_Sub(this.camViewTargetPos,n["default"].Vec_Mul(n["default"].Vec_Normalize(n["default"].Vec_Sub(this.camViewTargetPos,this.cameraPos)),this.minDistance)),o=n["default"].Vec_Sub(this.camViewTargetPos,n["default"].Vec_Mul(n["default"].Vec_Normalize(n["default"].Vec_Sub(this.camViewTargetPos,this.cameraPos)),this.maxDistance));t.x=a.x<o.x?n["default"].Clamp(t.x,a.x,o.x):n["default"].Clamp(t.x,o.x,a.x),t.y=a.y<o.y?n["default"].Clamp(t.y,a.y,o.y):n["default"].Clamp(t.y,o.y,a.y),t.z=a.z<o.z?n["default"].Clamp(t.z,a.z,o.z):n["default"].Clamp(t.z,o.z,a.z),this.cameraPos=t,this.isNeedAdjust=!0}},t}(Laya.Script3D);a["default"]=i},{"./GameMgr":4,"./utils/Mathf":5}],4:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("./CameraSpin"),n=function(e){function t(){return e.call(this)||this}return __extends(t,e),t.prototype.onAwake=function(){t.instance=this},t.prototype.onEnable=function(){},t.prototype.onDisable=function(){},t.prototype.onStart=function(){Laya.Scene3D.load("res/LayaScene_scene/Conventional/scene.ls",Laya.Handler.create(this,this.onLoadSceneCmp))},t.prototype.onLoadSceneCmp=function(e){Laya.stage.addChild(e),this.scene3D=e,e.zOrder=-1;var t=e.getChildByName("Main Camera");t.addComponent(o["default"])},t}(Laya.Script);a["default"]=n},{"./CameraSpin":3}],5:[function(e,t,a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=function(){function e(){}return e.Vec_Add=function(e,t){var a=new Laya.Vector3;return Laya.Vector3.add(e,t,a),a},e.Vec_Sub=function(e,t){var a=new Laya.Vector3;return Laya.Vector3.subtract(e,t,a),a},e.Vec_Mul=function(e,t){var a=new Laya.Vector3;return Laya.Vector3.multiply(e,new Laya.Vector3(t,t,t),a),a},e.Vec_Normalize=function(e){var t=new Laya.Vector3;return Laya.Vector3.normalize(e,t),t},e.VecToQua=function(e){var t=new Laya.Quaternion;return Laya.Quaternion.createFromYawPitchRoll(e.y*Math.PI/180,e.x*Math.PI/180,e.z*Math.PI/180,t),t},e.VecDotQua=function(e,t){var a=new Laya.Vector3;return Laya.Vector3.transformQuat(e,t,a),a},e.Clamp=function(e,t,a){return t>e?t:e>a?a:e},e.ClampAngle=function(t,a,o){return-360>t&&(t+=360),t>360&&(t-=360),e.Clamp(t,a,o)},e.QuaToVec=function(e){var t=new Laya.Vector3;return e.getYawPitchRoll(t),t=new Laya.Vector3(180*t.y/Math.PI,180*t.x/Math.PI,180*t.z/Math.PI)},e.GetToTargetRotation=function(t){var a=new Laya.Quaternion;return Laya.Quaternion.rotationLookAt(t,e.VEC_UP,a),a},e.VEC_UP=new Laya.Vector3(0,1,0),e}();a["default"]=o},{}]},{},[2]);